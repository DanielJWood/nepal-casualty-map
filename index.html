---
layout: default
---

<!-- Fallback info -->
<!--     <div class="rowDOE fallback">
      <div class="large-12 columnsDOE" style="background-color: #fbedc2; height:40px; padding-top:11px;">
        <center>Want to view this interactive graphic in all its glory? Upgrade to a modern browser!</center>
      </div>
    </div>
    <div class="fallback">
      <img src="img/consumption_fallback.jpg">
    </div> -->
           

            <!-- <select id="mySelect"></select> -->
  <div id="master_container" class="m_container">        

    <div class="rowDOE">
      <div class="large-12 columnsDOE headline">
        <center><h2>This is the <span class="green-text">foundation</span> template</h2></center>
      </div>
      <div class="large-12 columnsDOE subheadline">
        <p> This is interesting and <span class="has-tip tip-bottom" data-tooltip title="We define total per capita energy consumption as someone's annual transportation and residential energy needs combined.">important</span> information.</p>
      </div>
    </div>

</div>    
<!DOCTYPE html>
<meta charset="utf-8">
<style>

.districts_id {
  fill: none;
}

.states {
  fill: none;
  /*stroke: #fff;*/
  stroke: #000;
  stroke-linejoin: round;
}

.q0-9 { fill:rgb(247,251,255); }
.q1-9 { fill:rgb(222,235,247); }
.q2-9 { fill:rgb(198,219,239); }
.q3-9 { fill:rgb(158,202,225); }
.q4-9 { fill:rgb(107,174,214); }
.q5-9 { fill:rgb(66,146,198); }
.q6-9 { fill:rgb(33,113,181); }
.q7-9 { fill:rgb(8,81,156); }
.q8-9 { fill:rgb(8,48,107); }

.graticule {
  fill: none;
  stroke: #ce008d;
  stroke-opacity:0.5;
  stroke-width: 0.5px;
}
</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>

<script>

var width = 960,
    height = 600;

var rateById = d3.map();

var quantize = d3.scale.quantize()
    .domain([0, .15])
    .range(d3.range(9).map(function(i) { return "q" + i + "-9"; }));

// var projection = d3.geo.albers()
//     .scale(1280)
//     .translate([width / 2, height / 2]);

var distance = 5;
// var scale = 5500;
var scale = 1000;
var yaw = -82.00;
var pitch = 20;
var roll = 10;
var centerx = -10;
var centery = 55;
var tilt = 0;
var precision = 0.1 ;
var graticulex = 1;
var graticuley = 1; 
var clipAngle = Math.acos(1 / distance) * 180 / Math.PI - 1e-6;

// var projection = d3.geo.satellite()
var projection = d3.geo.albers()
  // .distance(distance)
  .scale(scale)    
  // .center([centerx, centery])
  // .tilt(tilt)
  // .clipAngle(clipAngle)
  // .precision(precision)
  // .clipExtent([[0, 0], [width, height]])
  .rotate([yaw, pitch, roll]) //yaw, pitch, roll    ;  

var graticule = d3.geo.graticule()
  // .extent([-36,-110.50],[-47,57])
  .step([graticulex, graticuley]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

svg.append("path")
  .datum(graticule)
  .attr("class", "graticule")
  .attr("d", path);
  

queue()
    // .defer(d3.json, "/mbostock/raw/4090846/us.json")
    .defer(d3.json, "data/districts_topo1.json")
    .defer(d3.tsv, "data/unemployment.tsv", function(d) { rateById.set(d.id, +d.rate); }) //match ID to rate?
    .await(ready);

function ready(error, districts_topo1) {
  svg.append("g")
      .attr("class", "districts_id")
    .selectAll("path")
      .data(topojson.feature(districts_topo1, districts_topo1.objects.districts_id).features)
    .enter().append("path")
      .attr("class", function(d) { return quantize(rateById.get(d.id)); })
      .attr("d", path);

// Draw the state borders
  svg.append("path")
      .datum(topojson.mesh(districts_topo1, districts_topo1.objects.districts_id, function(a, b) { 
        console.log('test')
        return a !== b; }))
      .attr("class", "states")
      .attr("d", path);
}

d3.select(self.frameElement).style("height", height + "px");

</script>
