
<!DOCTYPE html>

<!--[if lt IE 7 ]> <html class="lt-ie10 lt-ie9 lt-ie8 lt-ie7 ie6" lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" dir="ltr" prefix="og: http://opengraphprotocol.org/schema/ content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#"> <![endif]-->
<!--[if IE 7 ]>    <html class="lt-ie10 lt-ie9 lt-ie8 ie7" lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" dir="ltr" prefix="og: http://opengraphprotocol.org/schema/ content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#"> <![endif]-->
<!--[if IE 8 ]>    <html class="lt-ie10 lt-ie9 ie8" lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" dir="ltr" prefix="og: http://opengraphprotocol.org/schema/ content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#"> <![endif]-->
<!--[if IE 9 ]>    <html class="lt-ie10 ie9" lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" dir="ltr" prefix="og: http://opengraphprotocol.org/schema/ content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" dir="ltr" prefix="og: http://opengraphprotocol.org/schema/ content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#"> <!--<![endif]-->

<head profile="http://www.w3.org/1999/xhtml/vocab">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=8" />


<!-- Could put other css here, such as map css, etc-->


<!-- Begin Foundation  -->
    <link rel="stylesheet" href="css/foundation/foundation_doe.css" />
    <script src="/js/vendor/modernizr.js"></script>
<!-- End Foundation -->

<!-- Begin Merged CSS -->


<link rel="stylesheet" type="text/css" href="css/style.css">


<!-- /End Merged CSS -->


<!-- Master CSS for Energy.gov, including fonts, etc -->
<link rel="stylesheet" type="text/css" href="css/fonts.css">


<!-- Fallback CSS if/when above links break -->
<link rel="stylesheet" type="text/css" href="css/master_style.css">

<meta name="viewport" content="width=device-width, maximum-scale=2, minimum-scale=1, initial-scale=1, user-scalable=yes" />
<!--[if lt IE 9]>
<style type="text/css">
  #master_container {display: none;}  
  .fallback img {
    display: block;
  }
  .fallback {
    display: inline;
  }
</style>
<![endif]-->


</head>


<body class="html not-front not-logged-in one-sidebar sidebar-second page-node page-node- page-node-811664 node-type-article group-context group-context-group-1 group-context-taxonomy-term group-context-taxonomy-term-31 has-content-sidebar" >
  <div id="page" class="container column-row">    
    <div class="content">


      <!-- Begin Merged Markup.html partial Content -->
      
        <!-- Fallback info -->
<!--     <div class="rowDOE fallback">
      <div class="large-12 columnsDOE" style="background-color: #fbedc2; height:40px; padding-top:11px;">
        <center>Want to view this interactive graphic in all its glory? Upgrade to a modern browser!</center>
      </div>
    </div>
    <div class="fallback">
      <img src="img/consumption_fallback.jpg">
    </div> -->
           

            <!-- <select id="mySelect"></select> -->
  <div id="master_container" class="m_container">        

    <div class="rowDOE">
      <div class="large-12 columnsDOE headline">
        <center><h2>This is the <span class="green-text">foundation</span> template</h2></center>
      </div>
      <div class="large-12 columnsDOE subheadline">
        <p> This is interesting and <span class="has-tip tip-bottom" data-tooltip title="We define total per capita energy consumption as someone's annual transportation and residential energy needs combined.">important</span> information.</p>
      </div>
    </div>

</div>    
<!DOCTYPE html>
<meta charset="utf-8">
<style>

.districts_id {
  fill: none;
}

.states {
  fill: none;
  /*stroke: #fff;*/
  stroke: #ddd;
  stroke-linejoin: round;
}

/*.q0-9 { fill:rgb(247,251,255); }
.q1-9 { fill:rgb(222,235,247); }
.q2-9 { fill:rgb(198,219,239); }
.q3-9 { fill:rgb(158,202,225); }
.q4-9 { fill:rgb(107,174,214); }
.q5-9 { fill:rgb(66,146,198); }
.q6-9 { fill:rgb(33,113,181); }
.q7-9 { fill:rgb(8,81,156); }
.q8-9 { fill:rgb(8,48,107); }*/

.q0 { fill:rgb(255,255,255); }
.q1 { fill:rgb(222,235,247); }
.q2 { fill:rgb(198,219,239); }
.q3 { fill:rgb(158,202,225); }
.q4 { fill:rgb(107,174,214); }
.q5 { fill:rgb(66,146,198); }
.q6 { fill:rgb(33,113,181); }
.q7 { fill:rgb(8,81,156); }
.q8 { fill:rgb(8,48,107); }

.graticule {
  fill: none;
  stroke: #ce008d;
  stroke-opacity:0.5;
  stroke-width: 0.5px;
}
</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>

<script>

var width = 960,
    height = 600;

var rateById = d3.map();

var quantize = d3.scale.quantize()
    .domain([0, 2000])
    .range(d3.range(9).map(function(i) { return "q" + i + "-9"; }));

// Ramp paraemters, first for dead, then for injuries
var rampameters = [[0,10,50,100,500,1000,2000],[0,10,50,100,500,1000,4000]]

//m = 0 is dead map, m = 1 is injured map;
var m = 0;

// define the color ramp function
var ramp = function(d, m) {
  if (m === 0) {
    var o = d.properties.dead;
  } else if (m === 1) {
    var o = d.properties.injured;
  };
  
  for (var i = 0; i < rampameters[m].length; i++) {
    console.log(rampameters[m][i])
    if (o <= rampameters[m][i]) {
      var qclass = "q" + i;
      break;
    };
  };
  return qclass;
}

// var projection = d3.geo.albers()
//     .scale(1280)
//     .translate([width / 2, height / 2]);

var distance = 5;
// var scale = 5500;
var scale = 5500;
var yaw = -85.00;
var pitch = 10;
var roll = 0;
var centerx = -10;
var centery = 55;
var tilt = 0;
var precision = 0.1 ;
var graticulex = 1;
var graticuley = 1; 
var clipAngle = Math.acos(1 / distance) * 180 / Math.PI - 1e-6;

// var projection = d3.geo.satellite()
var projection = d3.geo.albers()
  // .distance(distance)
  .scale(scale)    
  // .center([centerx, centery])
  // .tilt(tilt)
  // .clipAngle(clipAngle)
  // .precision(precision)
  // .clipExtent([[0, 0], [width, height]])
  .rotate([yaw, pitch, roll]) //yaw, pitch, roll    ;  

var graticule = d3.geo.graticule()
  // .extent([-36,-110.50],[-47,57])
  .step([graticulex, graticuley]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

svg.append("path")
  .datum(graticule)
  .attr("class", "graticule")
  .attr("d", path);
  

queue()
    // .defer(d3.json, "/mbostock/raw/4090846/us.json")
    .defer(d3.json, "data/districts_topo3.json")
    // .defer(d3.tsv, "data/unemployment.tsv", function(d) { rateById.set(d.id, +d.rate); }) //match ID to rate?
    .defer(d3.csv, "data/casualty2904151130.csv", function(d) {
      rateById.set(d.distID, +d.injured); 
    }) //match ID to rate?
    .await(ready);

function ready(error, districts_topo3) {
  svg.append("g")
      .attr("class", "districts_id")
    .selectAll("path")
      .data(topojson.feature(districts_topo3, districts_topo3.objects.districts_id).features)
    .enter().append("path")
      .attr("class", function(d) { 
        // console.log(quantize(rateById.get(d.id)))
        return ramp(d,m)
        // return quantize(rateById.get(d.id)); 
      })
      .attr("d", path);

// Draw the state borders
  svg.append("path")
      .datum(topojson.mesh(districts_topo3, districts_topo3.objects.districts_id, function(a, b) { 
        return a !== b; }))
      .attr("class", "states")
      .attr("d", path);
}

d3.select(self.frameElement).style("height", height + "px");

</script>


      <!-- /End Merged Content -->


    </div>
  </div>

<!-- Javascript references -->
  <!-- Libraries such as jquery, mapbox, highcharts. Can (probably should) be referenced from external setting-->
  
  <!-- Foundation Libraries -->
    <script src="js/vendor/jquery.js"></script>

    <!-- Foundation 2 is smaller and contains only certain aspects of the full foundation code -->
    <script src="js/foundation2.min.js"></script>

    <!-- Initiate the foundation js -->
    <script>
    (function ($) { 
      $(document).foundation();
    }(jQuery));  
    </script>

  <!-- Foundation libraries end -->

  <!-- Data (JSON, etc) -->
  <script type="text/javascript" src="js/data.js"></script>

  <!-- Scripts (get to work) like script.js -->

  <script type="text/javascript" src="js/script.js"></script>

<!-- /End JS references -->

</body>
</html>
